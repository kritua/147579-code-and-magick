{"version":3,"sources":["webpack:///webpack/bootstrap c7c4b541cc2009e038f2","webpack:///./src/main.js","webpack:///./src/form.js","webpack:///./~/browser-cookies/src/browser-cookies.js","webpack:///./src/game.js","webpack:///./src/gallery.js","webpack:///./src/reviews.js","webpack:///./src/review.js","webpack:///./src/load.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,aAAY,WAAW;AACvB;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AChCA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;;;;;;;;;;;AC1GA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,wCAAuC;AACvC,0CAAyC;AACzC,iBAAgB;AAChB,iBAAgB;AAChB,iBAAgB;AAChB,iBAAgB,wBAAwB;AACxC;;AAEA;AACA,yCAAwC;;AAExC;AACA,iBAAgB,oBAAoB;AACpC;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AClEA;;AAEA;AACA;AACA,WAAU;AACV;AACA;;AAEA;AACA;AACA,WAAU;AACV;AACA;;AAEA;AACA;AACA,WAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAU;AACV;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAU;AACV;AACA;;AAEA;AACA;AACA,WAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAU;AACV;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAU;AACV;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAU;AACV;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,aAAY;AACZ;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;;AAEA;AACA;AACA,WAAU;AACV;AACA;;AAEA;AACA;AACA,YAAW,OAAO;AAClB,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAY;AACZ;AACA;;AAEA,eAAc,QAAQ;AACtB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA,eAAc;AACd;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,cAAa,OAAO;AACpB,cAAa,SAAS;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,MAAK;AACL,IAAG;;AAEH;AACA;AACA,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,IAAG;;AAEH;AACA;AACA,cAAa,eAAe;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,MAAK;;AAEL;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;AACA;AACA;AACA,oBAAmB,OAAO;AAC1B,qBAAoB;AACpB;AACA;AACA;AACA;AACA,YAAW;;AAEX;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA,oBAAmB,OAAO;AAC1B,qBAAoB;AACpB;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA,oBAAmB,OAAO;AAC1B,qBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA,cAAa,cAAc;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;;AAEH;AACA,cAAa,cAAc;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;;;;ACzxBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AC3FA;;AAEA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;;;;;;;;;;ACjBA;;AAEA;AACA;;AAEA;AACA;AACA,EAAC;AACD;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,GAAE;;AAEF;;;;;;;AC1FA;;AAEA;;AAEA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,SAAS;AACpB;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA","file":"js/main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c7c4b541cc2009e038f2\n **/","'use strict';\r\n\r\n\r\nvar form = require('./form');\r\nvar Game = require('./game');\r\nvar Gallery = require('./gallery');\r\nvar reviewData = require('./reviews');\r\nvar reviewsLoad = require('./load');\r\nvar apiURL = 'http://localhost:1506/api/reviews';\r\n\r\nvar game = new Game(document.querySelector('.demo'));\r\nvar formOpenButton = document.querySelector('.reviews-controls-new');\r\n\r\n/** @param {MouseEvent} evt */\r\nformOpenButton.onclick = function(evt) {\r\n  evt.preventDefault();\r\n  form.open(function() {\r\n    game.setGameStatus(Game.Verdict.PAUSE);\r\n    game.setDeactivated(true);\r\n  });\r\n};\r\n\r\nform.onClose = function() {\r\n  game.setDeactivated(false);\r\n};\r\n\r\ngame.initializeLevelAndStart();\r\ngame.setGameStatus(Game.Verdict.INTRO);\r\n\r\nreviewsLoad(apiURL, reviewData);\r\n\r\nvar gallery = new Gallery('.photogallery');\r\ngallery.initialize();\r\n\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/main.js\n ** module id = 0\n ** module chunks = 0\n **/","'use strict';\r\n\r\nvar formContainer = document.querySelector('.overlay-container');\r\nvar formCloseButton = document.querySelector('.review-form-close');\r\n/* Form Validation Variables */\r\nvar formOverlay = document.querySelector('.review-form');\r\nvar name = formOverlay.elements['review-name'];\r\nvar text = formOverlay.elements['review-text'];\r\nvar stars = formOverlay.elements['review-mark'];\r\nvar submitButton = document.querySelector('.review-submit');\r\nvar textReviewField = document.querySelector('.review-fields-text');\r\nvar nameReviewField = document.querySelector('.review-fields-name');\r\nvar bothLabelFields = document.querySelector('.review-fields');\r\n/* Cookies variables */\r\nvar cookies = require('browser-cookies');\r\n\r\n\r\nname.required = true;\r\nsubmitButton.disabled = true;\r\n\r\nformOverlay.onchange = formValidation;\r\n\r\nfunction formValidation() {\r\n  submitButton.disabled = !validation();\r\n  saveCookies();\r\n}\r\n\r\nfunction validation() {\r\n  text.required = (stars.value < 3);\r\n  var nameValidation = (name.value !== '');\r\n  var textValidation = (text.value !== '') || (stars.value >= 3);\r\n\r\n  hideLabels(nameReviewField, !nameValidation);\r\n  hideLabels(textReviewField, !textValidation);\r\n  hideLabels(bothLabelFields, !nameValidation, !textValidation);\r\n  return nameValidation && textValidation;\r\n}\r\n\r\nfunction hideLabels(elem, attr, attr2) {\r\n  elem.classList.toggle('invisible', !attr && !attr2);\r\n}\r\n\r\n\r\n\r\nfunction cookieValueGrace() {\r\n  var msecondsPerDay = 24 * 60 * 60 * 1000;\r\n  var currentDate = new Date();\r\n  var yearOfCount = '';\r\n  var lastBirthDayDate = new Date(currentDate.getFullYear() - 1, 11, 9);\r\n  var lastBirthDay;\r\n  var totalDays;\r\n\r\n  totalDays = Math.round((currentDate - lastBirthDayDate) / msecondsPerDay);\r\n  if (totalDays <= 365) {\r\n    yearOfCount = currentDate.getFullYear() - 1;\r\n  } else {\r\n    yearOfCount = currentDate.getFullYear();\r\n  }\r\n\r\n  lastBirthDay = new Date(yearOfCount, 11, 9);\r\n  totalDays = Math.round((currentDate - lastBirthDay) / msecondsPerDay);\r\n  return totalDays;\r\n}\r\n\r\nfunction saveCookies() {\r\n  var options = {\r\n    expires: cookieValueGrace()\r\n  };\r\n  cookies.set('review-name', name.value, options);\r\n  cookies.set('review-mark', stars.value, options);\r\n}\r\n\r\nfunction getCookies() {\r\n  name.value = cookies.get('review-name');\r\n  stars.value = cookies.get('review-mark');\r\n}\r\n\r\n\r\nvar form = {\r\n  onClose: null,\r\n\r\n  /**\r\n   * @param {Function} cb\r\n   */\r\n  open: function(cb) {\r\n    formContainer.classList.remove('invisible');\r\n    cb();\r\n    getCookies();\r\n  },\r\n\r\n  close: function() {\r\n    formContainer.classList.add('invisible');\r\n\r\n    if (typeof this.onClose === 'function') {\r\n      this.onClose();\r\n    }\r\n  }\r\n};\r\n\r\n\r\nformCloseButton.onclick = function(evt) {\r\n  evt.preventDefault();\r\n  form.close();\r\n};\r\n\r\n\r\nmodule.exports = form;\r\n\r\n\r\n\r\n\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/form.js\n ** module id = 1\n ** module chunks = 0\n **/","exports.defaults = {};\n\nexports.set = function(name, value, options) {\n  // Retrieve options and defaults\n  var opts = options || {};\n  var defaults = exports.defaults;\n\n  // Apply default value for unspecified options\n  var expires  = opts.expires || defaults.expires;\n  var domain   = opts.domain  || defaults.domain;\n  var path     = opts.path     != undefined ? opts.path     : (defaults.path != undefined ? defaults.path : '/');\n  var secure   = opts.secure   != undefined ? opts.secure   : defaults.secure;\n  var httponly = opts.httponly != undefined ? opts.httponly : defaults.httponly;\n\n  // Determine cookie expiration date\n  // If succesful the result will be a valid Date, otherwise it will be an invalid Date or false(ish)\n  var expDate = expires ? new Date(\n      // in case expires is an integer, it should specify the number of days till the cookie expires\n      typeof expires == 'number' ? new Date().getTime() + (expires * 864e5) :\n      // else expires should be either a Date object or in a format recognized by Date.parse()\n      expires\n  ) : '';\n\n  // Set cookie\n  document.cookie = name.replace(/[^+#$&^`|]/g, encodeURIComponent)                // Encode cookie name\n  .replace('(', '%28')\n  .replace(')', '%29') +\n  '=' + value.replace(/[^+#$&/:<-\\[\\]-}]/g, encodeURIComponent) +                  // Encode cookie value (RFC6265)\n  (expDate && expDate.getTime() >= 0 ? ';expires=' + expDate.toUTCString() : '') + // Add expiration date\n  (domain   ? ';domain=' + domain : '') +                                          // Add domain\n  (path     ? ';path='   + path   : '') +                                          // Add path\n  (secure   ? ';secure'           : '') +                                          // Add secure option\n  (httponly ? ';httponly'         : '');                                           // Add httponly option\n};\n\nexports.get = function(name) {\n  var cookies = document.cookie.split(';');\n\n  // Iterate all cookies\n  for(var i = 0; i < cookies.length; i++) {\n    var cookie = cookies[i];\n    var cookieLength = cookie.length;\n\n    // Determine separator index (\"name=value\")\n    var separatorIndex = cookie.indexOf('=');\n\n    // IE<11 emits the equal sign when the cookie value is empty\n    separatorIndex = separatorIndex < 0 ? cookieLength : separatorIndex;\n\n    // Decode the cookie name and remove any leading/trailing spaces, then compare to the requested cookie name\n    if (decodeURIComponent(cookie.substring(0, separatorIndex).replace(/^\\s+|\\s+$/g, '')) == name) {\n      return decodeURIComponent(cookie.substring(separatorIndex + 1, cookieLength));\n    }\n  }\n\n  return null;\n};\n\nexports.erase = function(name, options) {\n  exports.set(name, '', {\n    expires:  -1,\n    domain:   options && options.domain,\n    path:     options && options.path,\n    secure:   0,\n    httponly: 0}\n  );\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/browser-cookies/src/browser-cookies.js\n ** module id = 2\n ** module chunks = 0\n **/","'use strict';\r\n\r\n/**\r\n * @const\r\n * @type {number}\r\n */\r\nvar HEIGHT = 300;\r\n\r\n/**\r\n * @const\r\n * @type {number}\r\n */\r\nvar WIDTH = 700;\r\n\r\n/**\r\n * ID уровней.\r\n * @enum {number}\r\n */\r\nvar Level = {\r\n  INTRO: 0,\r\n  MOVE_LEFT: 1,\r\n  MOVE_RIGHT: 2,\r\n  LEVITATE: 3,\r\n  HIT_THE_MARK: 4\r\n};\r\n\r\n/**\r\n * Порядок прохождения уровней.\r\n * @type {Array.<Level>}\r\n */\r\nvar LevelSequence = [\r\n  Level.INTRO\r\n];\r\n\r\n/**\r\n * Начальный уровень.\r\n * @type {Level}\r\n */\r\nvar INITIAL_LEVEL = LevelSequence[0];\r\n\r\n/**\r\n * Допустимые виды объектов на карте.\r\n * @enum {number}\r\n */\r\nvar ObjectType = {\r\n  ME: 0,\r\n  FIREBALL: 1\r\n};\r\n\r\n/**\r\n * Допустимые состояния объектов.\r\n * @enum {number}\r\n */\r\nvar ObjectState = {\r\n  OK: 0,\r\n  DISPOSED: 1\r\n};\r\n\r\n/**\r\n * Коды направлений.\r\n * @enum {number}\r\n */\r\nvar Direction = {\r\n  NULL: 0,\r\n  LEFT: 1,\r\n  RIGHT: 2,\r\n  UP: 4,\r\n  DOWN: 8\r\n};\r\n\r\n/**\r\n * Правила перерисовки объектов в зависимости от состояния игры.\r\n * @type {Object.<ObjectType, function(Object, Object, number): Object>}\r\n */\r\nvar ObjectsBehaviour = {};\r\n\r\n/**\r\n * Обновление движения мага. Движение мага зависит от нажатых в данный момент\r\n * стрелок. Маг может двигаться одновременно по горизонтали и по вертикали.\r\n * На движение мага влияет его пересечение с препятствиями.\r\n * @param {Object} object\r\n * @param {Object} state\r\n * @param {number} timeframe\r\n */\r\nObjectsBehaviour[ObjectType.ME] = function(object, state, timeframe) {\r\n  // Пока зажата стрелка вверх, маг сначала поднимается, а потом левитирует\r\n  // в воздухе на определенной высоте.\r\n  // NB! Сложность заключается в том, что поведение описано в координатах\r\n  // канваса, а не координатах, относительно нижней границы игры.\r\n  if (state.keysPressed.UP && object.y > 0) {\r\n    object.direction = object.direction & ~Direction.DOWN;\r\n    object.direction = object.direction | Direction.UP;\r\n    object.y -= object.speed * timeframe * 2;\r\n\r\n    if (object.y < 0) {\r\n      object.y = 0;\r\n    }\r\n  }\r\n\r\n  // Если стрелка вверх не зажата, а маг находится в воздухе, он плавно\r\n  // опускается на землю.\r\n  if (!state.keysPressed.UP) {\r\n    if (object.y < HEIGHT - object.height) {\r\n      object.direction = object.direction & ~Direction.UP;\r\n      object.direction = object.direction | Direction.DOWN;\r\n      object.y += object.speed * timeframe / 3;\r\n    } else {\r\n      object.Direction = object.direction & ~Direction.DOWN;\r\n    }\r\n  }\r\n\r\n  // Если зажата стрелка влево, маг перемещается влево.\r\n  if (state.keysPressed.LEFT) {\r\n    object.direction = object.direction & ~Direction.RIGHT;\r\n    object.direction = object.direction | Direction.LEFT;\r\n    object.x -= object.speed * timeframe;\r\n  }\r\n\r\n  // Если зажата стрелка вправо, маг перемещается вправо.\r\n  if (state.keysPressed.RIGHT) {\r\n    object.direction = object.direction & ~Direction.LEFT;\r\n    object.direction = object.direction | Direction.RIGHT;\r\n    object.x += object.speed * timeframe;\r\n  }\r\n\r\n  // Ограничения по перемещению по полю. Маг не может выйти за пределы поля.\r\n  if (object.y < 0) {\r\n    object.y = 0;\r\n    object.Direction = object.direction & ~Direction.DOWN;\r\n    object.Direction = object.direction & ~Direction.UP;\r\n  }\r\n\r\n  if (object.y > HEIGHT - object.height) {\r\n    object.y = HEIGHT - object.height;\r\n    object.Direction = object.direction & ~Direction.DOWN;\r\n    object.Direction = object.direction & ~Direction.UP;\r\n  }\r\n\r\n  if (object.x < 0) {\r\n    object.x = 0;\r\n  }\r\n\r\n  if (object.x > WIDTH - object.width) {\r\n    object.x = WIDTH - object.width;\r\n  }\r\n};\r\n\r\n/**\r\n * Обновление движения файрбола. Файрбол выпускается в определенном направлении\r\n * и после этого неуправляемо движется по прямой в заданном направлении. Если\r\n * он пролетает весь экран насквозь, он исчезает.\r\n * @param {Object} object\r\n * @param {Object} state\r\n * @param {number} timeframe\r\n */\r\nObjectsBehaviour[ObjectType.FIREBALL] = function(object, state, timeframe) {\r\n  if (object.direction & Direction.LEFT) {\r\n    object.x -= object.speed * timeframe;\r\n  }\r\n\r\n  if (object.direction & Direction.RIGHT) {\r\n    object.x += object.speed * timeframe;\r\n  }\r\n\r\n  if (object.x < 0 || object.x > WIDTH) {\r\n    object.state = ObjectState.DISPOSED;\r\n  }\r\n};\r\n\r\n/**\r\n * ID возможных ответов функций, проверяющих успех прохождения уровня.\r\n * CONTINUE говорит о том, что раунд не закончен и игру нужно продолжать,\r\n * WIN о том, что раунд выигран, FAIL — о поражении. PAUSE о том, что игру\r\n * нужно прервать.\r\n * @enum {number}\r\n */\r\nvar Verdict = {\r\n  CONTINUE: 0,\r\n  WIN: 1,\r\n  FAIL: 2,\r\n  PAUSE: 3,\r\n  INTRO: 4\r\n};\r\n\r\n/**\r\n * Правила завершения уровня. Ключами служат ID уровней, значениями функции\r\n * принимающие на вход состояние уровня и возвращающие true, если раунд\r\n * можно завершать или false если нет.\r\n * @type {Object.<Level, function(Object):boolean>}\r\n */\r\nvar LevelsRules = {};\r\n\r\n/**\r\n * Уровень считается пройденным, если был выпущен файлболл и он улетел\r\n * за экран.\r\n * @param {Object} state\r\n * @return {Verdict}\r\n */\r\nLevelsRules[Level.INTRO] = function(state) {\r\n  var fireballs = state.garbage.filter(function(object) {\r\n    return object.type === ObjectType.FIREBALL;\r\n  });\r\n\r\n  return fireballs.length ? Verdict.WIN : Verdict.CONTINUE;\r\n};\r\n\r\n/**\r\n * Начальные условия для уровней.\r\n * @enum {Object.<Level, function>}\r\n */\r\nvar LevelsInitialize = {};\r\n\r\n/**\r\n * Первый уровень.\r\n * @param {Object} state\r\n * @return {Object}\r\n */\r\nLevelsInitialize[Level.INTRO] = function(state) {\r\n  state.objects.push(\r\n    // Установка персонажа в начальное положение. Он стоит в крайнем левом\r\n    // углу экрана, глядя вправо. Скорость перемещения персонажа на этом\r\n    // уровне равна 2px за кадр.\r\n    {\r\n      direction: Direction.RIGHT,\r\n      height: 84,\r\n      speed: 2,\r\n      sprite: 'img/wizard.gif',\r\n      spriteReversed: 'img/wizard-reversed.gif',\r\n      state: ObjectState.OK,\r\n      type: ObjectType.ME,\r\n      width: 61,\r\n      x: WIDTH / 3,\r\n      y: HEIGHT - 100\r\n    }\r\n  );\r\n\r\n  return state;\r\n};\r\n\r\n/**\r\n * Конструктор объекта Game. Создает canvas, добавляет обработчики событий\r\n * и показывает приветственный экран.\r\n * @param {Element} container\r\n * @constructor\r\n */\r\nvar Game = function(container) {\r\n  this.container = container;\r\n  this.canvas = document.createElement('canvas');\r\n  this.canvas.width = container.clientWidth;\r\n  this.canvas.height = container.clientHeight;\r\n  this.container.appendChild(this.canvas);\r\n\r\n  this.ctx = this.canvas.getContext('2d');\r\n\r\n  this._onKeyDown = this._onKeyDown.bind(this);\r\n  this._onKeyUp = this._onKeyUp.bind(this);\r\n  this._pauseListener = this._pauseListener.bind(this);\r\n\r\n  this.setDeactivated(false);\r\n};\r\n\r\nGame.prototype = {\r\n  /**\r\n   * Текущий уровень игры.\r\n   * @type {Level}\r\n   */\r\n  level: INITIAL_LEVEL,\r\n\r\n  /** @param {boolean} deactivated */\r\n  setDeactivated: function(deactivated) {\r\n    if (this._deactivated === deactivated) {\r\n      return;\r\n    }\r\n\r\n    this._deactivated = deactivated;\r\n\r\n    if (deactivated) {\r\n      this._removeGameListeners();\r\n    } else {\r\n      this._initializeGameListeners();\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Состояние игры. Описывает местоположение всех объектов на игровой карте\r\n   * и время проведенное на уровне и в игре.\r\n   * @return {Object}\r\n   */\r\n  getInitialState: function() {\r\n    return {\r\n      // Статус игры. Если CONTINUE, то игра продолжается.\r\n      currentStatus: Verdict.CONTINUE,\r\n\r\n      // Объекты, удаленные на последнем кадре.\r\n      garbage: [],\r\n\r\n      // Время с момента отрисовки предыдущего кадра.\r\n      lastUpdated: null,\r\n\r\n      // Состояние нажатых клавиш.\r\n      keysPressed: {\r\n        ESC: false,\r\n        LEFT: false,\r\n        RIGHT: false,\r\n        SPACE: false,\r\n        UP: false\r\n      },\r\n\r\n      // Время начала прохождения уровня.\r\n      levelStartTime: null,\r\n\r\n      // Все объекты на карте.\r\n      objects: [],\r\n\r\n      // Время начала прохождения игры.\r\n      startTime: null\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Начальные проверки и запуск текущего уровня.\r\n   * @param {Level=} level\r\n   * @param {boolean=} restart\r\n   */\r\n  initializeLevelAndStart: function(level, restart) {\r\n    level = typeof level === 'undefined' ? this.level : level;\r\n    restart = typeof restart === 'undefined' ? true : restart;\r\n\r\n    if (restart || !this.state) {\r\n      // При перезапуске уровня, происходит полная перезапись состояния\r\n      // игры из изначального состояния.\r\n      this.state = this.getInitialState();\r\n      this.state = LevelsInitialize[this.level](this.state);\r\n    } else {\r\n      // При продолжении уровня состояние сохраняется, кроме записи о том,\r\n      // что состояние уровня изменилось с паузы на продолжение игры.\r\n      this.state.currentStatus = Verdict.CONTINUE;\r\n    }\r\n\r\n    // Запись времени начала игры и времени начала уровня.\r\n    this.state.levelStartTime = Date.now();\r\n    if (!this.state.startTime) {\r\n      this.state.startTime = this.state.levelStartTime;\r\n    }\r\n\r\n    this._preloadImagesForLevel(function() {\r\n      // Предварительная отрисовка игрового экрана.\r\n      this.render();\r\n\r\n      // Установка обработчиков событий.\r\n      this._initializeGameListeners();\r\n\r\n      // Запуск игрового цикла.\r\n      this.update();\r\n    }.bind(this));\r\n  },\r\n\r\n  /**\r\n   * Временная остановка игры.\r\n   * @param {Verdict=} verdict\r\n   */\r\n  pauseLevel: function(verdict) {\r\n    if (verdict) {\r\n      this.state.currentStatus = verdict;\r\n    }\r\n\r\n    this.state.keysPressed.ESC = false;\r\n    this.state.lastUpdated = null;\r\n\r\n    this._removeGameListeners();\r\n    window.addEventListener('keydown', this._pauseListener);\r\n\r\n    this._drawPauseScreen();\r\n  },\r\n\r\n  /**\r\n   * Обработчик событий клавиатуры во время паузы.\r\n   * @param {KeyboardsEvent} evt\r\n   * @private\r\n   * @private\r\n   */\r\n  _pauseListener: function(evt) {\r\n    if (evt.keyCode === 32 && !this._deactivated) {\r\n      evt.preventDefault();\r\n      var needToRestartTheGame = this.state.currentStatus === Verdict.WIN ||\r\n          this.state.currentStatus === Verdict.FAIL;\r\n      this.initializeLevelAndStart(this.level, needToRestartTheGame);\r\n\r\n      window.removeEventListener('keydown', this._pauseListener);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Отрисовка экрана паузы.\r\n   */\r\n  _drawPauseScreen: function() {\r\n    switch (this.state.currentStatus) {\r\n      case Verdict.WIN:\r\n        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(315, 205);\r\n        this.ctx.lineTo(335, 55);\r\n        this.ctx.lineTo(655, 55);\r\n        this.ctx.lineTo(655, 160);\r\n        this.ctx.lineTo(345, 180);\r\n        this.ctx.closePath();\r\n        this.ctx.fill();\r\n        this.ctx.fillStyle = 'white';\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(310, 200);\r\n        this.ctx.lineTo(330, 50);\r\n        this.ctx.lineTo(650, 50);\r\n        this.ctx.lineTo(650, 155);\r\n        this.ctx.lineTo(340, 175);\r\n        this.ctx.closePath();\r\n        this.ctx.fill();\r\n        this.ctx.stroke();\r\n        this.ctx.fillStyle = 'black';\r\n        this.ctx.font = '16px PT Mono';\r\n        this.ctx.fillText('Вы сейчас поджарили чью-то', 350, 70);\r\n        this.ctx.fillText('шкуру. Игры с огнём опасны.', 350, 90);\r\n        this.ctx.fillText('По возможности, жарьте', 350, 110);\r\n        this.ctx.fillText('больше злодеев и негодяев.', 350, 130);\r\n        this.ctx.fillText('\"Пробел\" чтобы сыграть ещё раз', 350, 150);\r\n        break;\r\n      case Verdict.FAIL:\r\n        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(315, 205);\r\n        this.ctx.lineTo(335, 55);\r\n        this.ctx.lineTo(655, 55);\r\n        this.ctx.lineTo(655, 160);\r\n        this.ctx.lineTo(345, 180);\r\n        this.ctx.closePath();\r\n        this.ctx.fill();\r\n        this.ctx.fillStyle = 'white';\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(310, 200);\r\n        this.ctx.lineTo(330, 50);\r\n        this.ctx.lineTo(650, 50);\r\n        this.ctx.lineTo(650, 155);\r\n        this.ctx.lineTo(340, 175);\r\n        this.ctx.closePath();\r\n        this.ctx.fill();\r\n        this.ctx.stroke();\r\n        this.ctx.fillStyle = 'black';\r\n        this.ctx.font = '16px PT Mono';\r\n        this.ctx.fillText('Вы ни на что не способны', 350, 70);\r\n        this.ctx.fillText('Просто смиритесь. Ни на что.', 350, 90);\r\n        this.ctx.fillText('Но вы можете попробовать ещё раз', 350, 110);\r\n        this.ctx.fillText('Просто нажмите \"Пробел\"', 350, 130);\r\n        break;\r\n      case Verdict.PAUSE:\r\n        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(315, 205);\r\n        this.ctx.lineTo(335, 55);\r\n        this.ctx.lineTo(655, 55);\r\n        this.ctx.lineTo(655, 160);\r\n        this.ctx.lineTo(345, 180);\r\n        this.ctx.closePath();\r\n        this.ctx.fill();\r\n        this.ctx.fillStyle = 'white';\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(310, 200);\r\n        this.ctx.lineTo(330, 50);\r\n        this.ctx.lineTo(650, 50);\r\n        this.ctx.lineTo(650, 155);\r\n        this.ctx.lineTo(340, 175);\r\n        this.ctx.closePath();\r\n        this.ctx.fill();\r\n        this.ctx.stroke();\r\n        this.ctx.fillStyle = 'black';\r\n        this.ctx.font = '16px PT Mono';\r\n        this.ctx.fillText('Игра на паузе', 350, 90);\r\n        this.ctx.fillText('Нажми \"Пробел\" для старта.', 350, 110);\r\n        break;\r\n      case Verdict.INTRO:\r\n        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(315, 205);\r\n        this.ctx.lineTo(335, 55);\r\n        this.ctx.lineTo(675, 55);\r\n        this.ctx.lineTo(675, 160);\r\n        this.ctx.lineTo(345, 180);\r\n        this.ctx.closePath();\r\n        this.ctx.fill();\r\n        this.ctx.fillStyle = 'white';\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(310, 200);\r\n        this.ctx.lineTo(330, 50);\r\n        this.ctx.lineTo(670, 50);\r\n        this.ctx.lineTo(670, 155);\r\n        this.ctx.lineTo(340, 175);\r\n        this.ctx.closePath();\r\n        this.ctx.fill();\r\n        this.ctx.stroke();\r\n        this.ctx.fillStyle = 'black';\r\n        this.ctx.font = '16px PT Mono';\r\n        this.ctx.fillText('Игра про мага, который там короче', 340, 70);\r\n        this.ctx.fillText('ходит и все такое в общем.', 340, 90);\r\n        this.ctx.fillText('Нажми \"Пробел\" для старта.', 340, 110);\r\n        this.ctx.fillText('Стрелки для управления и прыжка.', 340, 130);\r\n        this.ctx.fillText('\"Shift\" для запуска фаерболла.', 340, 150);\r\n        break;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Предзагрузка необходимых изображений для уровня.\r\n   * @param {function} callback\r\n   * @private\r\n   */\r\n  _preloadImagesForLevel: function(callback) {\r\n    if (typeof this._imagesArePreloaded === 'undefined') {\r\n      this._imagesArePreloaded = [];\r\n    }\r\n\r\n    if (this._imagesArePreloaded[this.level]) {\r\n      callback();\r\n      return;\r\n    }\r\n\r\n    var levelImages = [];\r\n    this.state.objects.forEach(function(object) {\r\n      levelImages.push(object.sprite);\r\n\r\n      if (object.spriteReversed) {\r\n        levelImages.push(object.spriteReversed);\r\n      }\r\n    });\r\n\r\n    var i = levelImages.length;\r\n    var imagesToGo = levelImages.length;\r\n\r\n    while (i-- > 0) {\r\n      var image = new Image();\r\n      image.src = levelImages[i];\r\n      image.onload = function() {\r\n        if (--imagesToGo === 0) {\r\n          this._imagesArePreloaded[this.level] = true;\r\n          callback();\r\n        }\r\n      }.bind(this);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Обновление статуса объектов на экране. Добавляет объекты, которые должны\r\n   * появиться, выполняет проверку поведения всех объектов и удаляет те, которые\r\n   * должны исчезнуть.\r\n   * @param {number} delta Время, прошеднее с отрисовки прошлого кадра.\r\n   */\r\n  updateObjects: function(delta) {\r\n    // Персонаж.\r\n    var me = this.state.objects.filter(function(object) {\r\n      return object.type === ObjectType.ME;\r\n    })[0];\r\n\r\n    // Добавляет на карту файрбол по нажатию на Shift.\r\n    if (this.state.keysPressed.SHIFT) {\r\n      this.state.objects.push({\r\n        direction: me.direction,\r\n        height: 24,\r\n        speed: 5,\r\n        sprite: 'img/fireball.gif',\r\n        type: ObjectType.FIREBALL,\r\n        width: 24,\r\n        x: me.direction & Direction.RIGHT ? me.x + me.width : me.x - 24,\r\n        y: me.y + me.height / 2\r\n      });\r\n\r\n      this.state.keysPressed.SHIFT = false;\r\n    }\r\n\r\n    this.state.garbage = [];\r\n\r\n    // Убирает в garbage не используемые на карте объекты.\r\n    var remainingObjects = this.state.objects.filter(function(object) {\r\n      ObjectsBehaviour[object.type](object, this.state, delta);\r\n\r\n      if (object.state === ObjectState.DISPOSED) {\r\n        this.state.garbage.push(object);\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    }, this);\r\n\r\n    this.state.objects = remainingObjects;\r\n  },\r\n\r\n  /**\r\n   * Проверка статуса текущего уровня.\r\n   */\r\n  checkStatus: function() {\r\n    // Нет нужны запускать проверку, нужно ли останавливать уровень, если\r\n    // заранее известно, что да.\r\n    if (this.state.currentStatus !== Verdict.CONTINUE) {\r\n      return;\r\n    }\r\n\r\n    if (!this.commonRules) {\r\n      /**\r\n       * Проверки, не зависящие от уровня, но влияющие на его состояние.\r\n       * @type {Array.<functions(Object):Verdict>}\r\n       */\r\n      this.commonRules = [\r\n        /**\r\n         * Если персонаж мертв, игра прекращается.\r\n         * @param {Object} state\r\n         * @return {Verdict}\r\n         */\r\n        function checkDeath(state) {\r\n          var me = state.objects.filter(function(object) {\r\n            return object.type === ObjectType.ME;\r\n          })[0];\r\n\r\n          return me.state === ObjectState.DISPOSED ?\r\n              Verdict.FAIL :\r\n              Verdict.CONTINUE;\r\n        },\r\n\r\n        /**\r\n         * Если нажата клавиша Esc игра ставится на паузу.\r\n         * @param {Object} state\r\n         * @return {Verdict}\r\n         */\r\n        function checkKeys(state) {\r\n          return state.keysPressed.ESC ? Verdict.PAUSE : Verdict.CONTINUE;\r\n        },\r\n\r\n        /**\r\n         * Игра прекращается если игрок продолжает играть в нее два часа подряд.\r\n         * @param {Object} state\r\n         * @return {Verdict}\r\n         */\r\n        function checkTime(state) {\r\n          return Date.now() - state.startTime > 3 * 60 * 1000 ?\r\n              Verdict.FAIL :\r\n              Verdict.CONTINUE;\r\n        }\r\n      ];\r\n    }\r\n\r\n    // Проверка всех правил влияющих на уровень. Запускаем цикл проверок\r\n    // по всем универсальным проверкам и проверкам конкретного уровня.\r\n    // Цикл продолжается до тех пор, пока какая-либо из проверок не вернет\r\n    // любое другое состояние кроме CONTINUE или пока не пройдут все\r\n    // проверки. После этого состояние сохраняется.\r\n    var allChecks = this.commonRules.concat(LevelsRules[this.level]);\r\n    var currentCheck = Verdict.CONTINUE;\r\n    var currentRule;\r\n\r\n    while (currentCheck === Verdict.CONTINUE && allChecks.length) {\r\n      currentRule = allChecks.shift();\r\n      currentCheck = currentRule(this.state);\r\n    }\r\n\r\n    this.state.currentStatus = currentCheck;\r\n  },\r\n\r\n  /**\r\n   * Принудительная установка состояния игры. Используется для изменения\r\n   * состояния игры от внешних условий, например, когда необходимо остановить\r\n   * игру, если она находится вне области видимости и установить вводный\r\n   * экран.\r\n   * @param {Verdict} status\r\n   */\r\n  setGameStatus: function(status) {\r\n    if (this.state.currentStatus !== status) {\r\n      this.state.currentStatus = status;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Отрисовка всех объектов на экране.\r\n   */\r\n  render: function() {\r\n    // Удаление всех отрисованных на странице элементов.\r\n    this.ctx.clearRect(0, 0, WIDTH, HEIGHT);\r\n\r\n    // Выставление всех элементов, оставшихся в this.state.objects согласно\r\n    // их координатам и направлению.\r\n    this.state.objects.forEach(function(object) {\r\n      if (object.sprite) {\r\n        var image = new Image(object.width, object.height);\r\n        image.src = (object.spriteReversed && object.direction & Direction.LEFT) ?\r\n            object.spriteReversed :\r\n            object.sprite;\r\n        this.ctx.drawImage(image, object.x, object.y, object.width, object.height);\r\n      }\r\n    }, this);\r\n  },\r\n\r\n  /**\r\n   * Основной игровой цикл. Сначала проверяет состояние всех объектов игры\r\n   * и обновляет их согласно правилам их поведения, а затем запускает\r\n   * проверку текущего раунда. Рекурсивно продолжается до тех пор, пока\r\n   * проверка не вернет состояние FAIL, WIN или PAUSE.\r\n   */\r\n  update: function() {\r\n    if (!this.state.lastUpdated) {\r\n      this.state.lastUpdated = Date.now();\r\n    }\r\n\r\n    var delta = (Date.now() - this.state.lastUpdated) / 10;\r\n    this.updateObjects(delta);\r\n    this.checkStatus();\r\n\r\n    switch (this.state.currentStatus) {\r\n      case Verdict.CONTINUE:\r\n        this.state.lastUpdated = Date.now();\r\n        this.render();\r\n        requestAnimationFrame(function() {\r\n          this.update();\r\n        }.bind(this));\r\n        break;\r\n\r\n      case Verdict.WIN:\r\n      case Verdict.FAIL:\r\n      case Verdict.PAUSE:\r\n      case Verdict.INTRO:\r\n        this.pauseLevel();\r\n        break;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @param {KeyboardEvent} evt [description]\r\n   * @private\r\n   */\r\n  _onKeyDown: function(evt) {\r\n    switch (evt.keyCode) {\r\n      case 37:\r\n        this.state.keysPressed.LEFT = true;\r\n        break;\r\n      case 39:\r\n        this.state.keysPressed.RIGHT = true;\r\n        break;\r\n      case 38:\r\n        this.state.keysPressed.UP = true;\r\n        break;\r\n      case 27:\r\n        this.state.keysPressed.ESC = true;\r\n        break;\r\n    }\r\n\r\n    if (evt.shiftKey) {\r\n      this.state.keysPressed.SHIFT = true;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @param {KeyboardEvent} evt [description]\r\n   * @private\r\n   */\r\n  _onKeyUp: function(evt) {\r\n    switch (evt.keyCode) {\r\n      case 37:\r\n        this.state.keysPressed.LEFT = false;\r\n        break;\r\n      case 39:\r\n        this.state.keysPressed.RIGHT = false;\r\n        break;\r\n      case 38:\r\n        this.state.keysPressed.UP = false;\r\n        break;\r\n      case 27:\r\n        this.state.keysPressed.ESC = false;\r\n        break;\r\n    }\r\n\r\n    if (evt.shiftKey) {\r\n      this.state.keysPressed.SHIFT = false;\r\n    }\r\n  },\r\n\r\n  /** @private */\r\n  _initializeGameListeners: function() {\r\n    window.addEventListener('keydown', this._onKeyDown);\r\n    window.addEventListener('keyup', this._onKeyUp);\r\n  },\r\n\r\n  /** @private */\r\n  _removeGameListeners: function() {\r\n    window.removeEventListener('keydown', this._onKeyDown);\r\n    window.removeEventListener('keyup', this._onKeyUp);\r\n  }\r\n};\r\n\r\nGame.Verdict = Verdict;\r\n\r\nmodule.exports = Game;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/game.js\n ** module id = 3\n ** module chunks = 0\n **/","'use strict';\r\n\r\nvar Gallery = function(picturesGallery) {\r\n  this.overlayGallery = document.querySelector('.overlay-gallery');\r\n  this.leftControl = document.querySelector('.overlay-gallery-control-left');\r\n  this.rightControl = document.querySelector('.overlay-gallery-control-right');\r\n  this.closeGallery = document.querySelector('.overlay-gallery-close');\r\n  this.currentSlide = document.querySelector('.preview-number-current');\r\n  this.previewSlide = document.querySelector('.overlay-gallery-preview');\r\n  this.total = document.querySelector('.preview-number-total');\r\n\r\n  this.photogallery = document.querySelector(picturesGallery);\r\n\r\n  this.nextSlide = this.nextPicture.bind(this);\r\n  this.prevSlide = this.prevPicture.bind(this);\r\n  this.hideGallery = this.hide.bind(this);\r\n  this.pictures = [];\r\n  this.activePicture = 0;\r\n  this.currentPicture = null;\r\n};\r\n\r\nGallery.prototype.initialize = function() {\r\n  var self = this;\r\n  var picturesLink = this.photogallery.querySelectorAll('.photogallery-image');\r\n  Array.prototype.forEach.call(picturesLink, function(item, i) {\r\n    item.onclick = function() {\r\n      self.show(i);\r\n    };\r\n    var image = item.querySelector('img');\r\n    self.pictures.push(image.src);\r\n  });\r\n  this.total.textContent = this.pictures.length;\r\n}\r\n\r\n/*\r\n Открываем галерею\r\n */\r\nGallery.prototype.show = function(activePicture) {\r\n  this.closeGallery.addEventListener('click', this.hideGallery);\r\n  this.rightControl.addEventListener('click', this.nextSlide);\r\n  this.leftControl.addEventListener('click', this.prevSlide);\r\n\r\n  this.overlayGallery.classList.remove('invisible');\r\n\r\n  this.setActivePicture(activePicture);\r\n};\r\n/*\r\n Закрываем галерею\r\n */\r\nGallery.prototype.hide = function() {\r\n  this.overlayGallery.classList.add('invisible');\r\n  this.closeGallery.removeEventListener('click', this.hideGallery);\r\n  this.rightControl.removeEventListener('click', this.nextSlide);\r\n  this.leftControl.removeEventListener('click', this.prevSlide);\r\n};\r\n/*\r\n Показ изображения\r\n */\r\nGallery.prototype.setActivePicture = function(activePicture) {\r\n  var image = new Image();\r\n  this.activePicture = activePicture;\r\n\r\n  image.src = this.pictures[activePicture];\r\n\r\n  if (this.currentPicture) {\r\n    this.previewSlide.replaceChild(image, this.currentPicture);\r\n  } else {\r\n    this.previewSlide.appendChild(image);\r\n  }\r\n\r\n  this.currentSlide.innerHTML = this.activePicture + 1;\r\n  this.currentPicture = image;\r\n};\r\n/*\r\n Следующая картинка\r\n */\r\nGallery.prototype.nextPicture = function() {\r\n  if (this.activePicture + 1 < this.pictures.length) {\r\n    this.setActivePicture(this.activePicture + 1);\r\n  }\r\n};\r\n/*\r\n Предыдущая картинка\r\n */\r\nGallery.prototype.prevPicture = function() {\r\n  // не this.pictures.length , а больше 0\r\n  if (this.activePicture - 1 >= 0) {\r\n    this.setActivePicture(this.activePicture - 1);\r\n  }\r\n};\r\n\r\nmodule.exports = Gallery;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/gallery.js\n ** module id = 4\n ** module chunks = 0\n **/","'use strict';\r\n\r\nvar Review = require('./review');\r\n\r\nvar reviewsFilter = document.querySelector('.reviews-filter');\r\nvar reviewsList = document.querySelector('.reviews-list');\r\n\r\n\r\nfunction reviewData(data) {\r\n  reviewsFilter.classList.add('invisible');\r\n  data.forEach(function(element) {\r\n    var review = new Review(element);\r\n    reviewsList.appendChild(review.elem);\r\n  });\r\n  reviewsFilter.classList.remove('invisible');\r\n}\r\n\r\nmodule.exports = reviewData;\r\n\r\n\r\n\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/reviews.js\n ** module id = 5\n ** module chunks = 0\n **/","'use strict';\r\n\r\nvar reviewsTemplate = document.querySelector('#review-template');\r\nvar cloneElem;\r\n\r\nif ('content' in reviewsTemplate) {\r\n  cloneElem = reviewsTemplate.content.querySelector('.review');\r\n} else {\r\n  cloneElem = reviewsTemplate.querySelector('.review');\r\n}\r\n\r\nvar Review = function(data) {\r\n  this.data = data;\r\n  \r\n  this.ACTIVE_ANSWER = 'review-quiz-answer-active';\r\n  \r\n  this.getElement();\r\n  this.desc.textContent = this.data.description;\r\n  this.rating(this.data.rating);\r\n  this.addImage();\r\n\r\n};\r\n\r\n\r\nReview.prototype.getElement = function() {\r\n  this.elem = cloneElem.cloneNode(true);\r\n  this.desc = this.elem.querySelector('.review-text');\r\n  this.rate = this.elem.querySelector('.review-rating');\r\n  this.author = this.elem.querySelector('.review-author');\r\n\r\n  this.answerNo = this.elem.querySelector('.review-quiz-answer-no');\r\n  this.answerYes = this.elem.querySelector('.review-quiz-answer-yes');\r\n};\r\n\r\n\r\nReview.prototype.rating = function() {\r\n  var rating = {\r\n    2: 'two',\r\n    3: 'three',\r\n    4: 'four',\r\n    5: 'five'\r\n  };\r\n  if (rating[this.data.rating]) {\r\n    this.rate.classList.add('review-rating-' + rating[this.data.rating]);\r\n  }\r\n};\r\n\r\nReview.prototype.addImage = function() {\r\n  var self = this;\r\n  function loadImage(imageURL, callback) {\r\n    var IMAGE_SIZE = '124px';\r\n    var IMAGE_LOAD_TIMEOUT = 10000;\r\n    var authorImage = new Image(IMAGE_SIZE, IMAGE_SIZE);\r\n    var imageLoadTimeout = null;\r\n   \r\n    \r\n\r\n    authorImage.onload = function () {\r\n      clearTimeout(imageLoadTimeout);\r\n      callback(true);\r\n    };\r\n\r\n    authorImage.onerror = function () {\r\n      clearTimeout(imageLoadTimeout);\r\n      callback(false);\r\n    };\r\n\r\n    authorImage.src = imageURL;\r\n\r\n    imageLoadTimeout = setTimeout(function () {\r\n      clearTimeout(imageLoadTimeout);\r\n      callback(false);\r\n    }, IMAGE_LOAD_TIMEOUT);\r\n  }\r\n\r\n  function isLoaded(loaded) {\r\n    if (loaded) {\r\n      this.author.src = self.data.author.picture;\r\n    } else {\r\n      this.author.src = '';\r\n      this.elem.classList.add('review-load-failure');\r\n    }\r\n  }\r\n  loadImage(this.data.author.picture, isLoaded.bind(this));\r\n};\r\n\r\n/* Review.prototype.usefulAnswer = function() {\r\n  \r\n}; */\r\n\r\nmodule.exports = Review;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/review.js\n ** module id = 6\n ** module chunks = 0\n **/","'use strict';\r\n\r\nwindow.CallBackRegistry = {};\r\n\r\n/**\r\n * JSONP запрос\r\n * @param {string} link адрес\r\n * @param {function} callback callback-функция\r\n */\r\n\r\nfunction reviewsLoad(link, callback) {\r\n  var callbackVar = 'callback' + String(Math.random()).slice(-6);\r\n  var script = document.createElement('script');\r\n\r\n  link = link + '?callback=CallBackRegistry.' + callbackVar;\r\n  window.CallBackRegistry[callbackVar] = function(data) {\r\n    callback(data);\r\n  };\r\n\r\n  script.onload = script.onerror = function() {\r\n    delete window.CallBackRegistry[callbackVar];\r\n    document.body.removeChild(script);\r\n  };\r\n\r\n  script.src = link;\r\n  document.body.appendChild(script);\r\n}\r\n\r\nmodule.exports = reviewsLoad;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/load.js\n ** module id = 7\n ** module chunks = 0\n **/"],"sourceRoot":""}